
{% extends 'base.html' %}
{% load static %}
{% load mahimsoft_tags %}
{% load month_filters %}
{% block title %}
  Masud's Photo Album
{% endblock %}

{% block extend_header %}
    <style>
.hidden-div {
  /* Start hidden */
  opacity: 0;
  visibility: hidden;
  
  /* Smooth transition */
  transition: opacity 0.4s ease-in-out;
  
  /* Styling for visibility */
  background-color: #f0f0f0;
  padding: 20px;
  border: 1px solid #ccc;
  margin-top: 10px;
}

/* When the user hovers over the container, show the div */
.search-container:hover .hidden-div {
  opacity: 1;
  visibility: visible;
}

.video-container {
  /* Define a max-width for the container if needed */
/* max-width: 800px;  */
  margin: auto;
}

.topbar {
  position: fixed;
  /* left: -200px; */
  top: -70px;
  /* height: 50px; */
  width: auto;
  transition: transform 0.3s ease;
}

.topbar:hover {
  transform: translateY(70px); /* Slides into view */
}

.video {
  width: 100%;
  height: auto; /* Maintains the video's native aspect ratio */
  
  /* Auto-resizes the poster image to cover the video element's dimensions */
  object-fit: cover; 
  
  /* Ensures consistency for the poster image */
  background-size: cover; 
  background-position: 50% 50%;
  
  /* Prevents layout shift as video loads (optional but recommended) */
  aspect-ratio: 16 / 9; /* Use the aspect ratio of your video (e.g., 16:9) */
}
    </style>
{% endblock extend_header %}
    
{% block content %}
<div class="flex justify-end items-center me-14">
      <h2 class="flex justify-center items-center gap-2 p-0 m-0 mb-2">
    {% if slides.0.person_name %}
    <span class="text-amber-700 text-2xl font-bold">
        {{slides.0.person_name}}, 
    </span>
    {% endif %}
    <span class="text-emerald-600 text-xl">
        No. of Images: {{total_images}} Nos.
    </span>
    </h2>
        <button onclick='location.href="{% url "locations:google_photos" %}"'  class="bg-green-600 text-white text-sm font-semibold py-1.5 px-4 ms-5 rounded-md hover:bg-green-700 transition-colors shadow-sm">
                Home
    </button>
</div>
<div class="max-w-4xl mx-auto mt-3 px-2">
    <div class="search-container mx-auto z-40 topbar">
        <div class="hidden-div w-full mx-auto mt-3 px-2">
  
    <!-- Search/Filter Form -->
       <section class="mx-auto mb-3 bg-white p-0 rounded-md shadow-sm border border-gray-100">
    <form method="GET" action="." class="flex flex-wrap md:flex-nowrap items-center gap-4.5">
        
        <div class="flex-1 min-w-[150px]">
            <label for="person_select" class="sr-only">Name</label>
            <select id="person_select" name="person_id" 
                class="block w-full px-3 py-1.5 text-sm border-gray-200 focus:ring-indigo-500 focus:border-indigo-500 rounded-md border bg-gray-50 cursor-pointer">
                <option value="">All People</option>
                {% for person in people %}
                <option value="{{ person.id }}" {% if request.GET.person_id == person.id|stringformat:"i" %}selected{% endif %}>
                    {{ person.name|title }}
                </option>
                {% endfor %}
                <option value="10000">Unknown</option>
            </select>
        </div>

        <div class="w-32">
            <label for="year_select" class="sr-only">Year</label>
            <select id="year_select" name="year" 
                class="block w-full px-3 py-1.5 text-sm border-gray-200 focus:ring-indigo-500 focus:border-indigo-500 rounded-md border bg-gray-50 cursor-pointer">
                <option value="0">Any Year</option>
                {% for y in years_list %}
                <option value="{{ y }}" {% if request.GET.year == y|stringformat:'i' %}selected{% endif %}>{{ y }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="w-36">
            <label for="month_select" class="sr-only">Month</label>
            <select id="month_select" name="month" 
                class="block w-full px-3 py-1.5 text-sm border-gray-200 focus:ring-indigo-500 focus:border-indigo-500 rounded-md border bg-gray-50 cursor-pointer">
                <option value="0">Any Month</option>
                <option value="1" {% if request.GET.month == "1" %}selected{% endif %}>Jan</option>
                <option value="2" {% if request.GET.month == "2" %}selected{% endif %}>Feb</option>
                <option value="3" {% if request.GET.month == "3" %}selected{% endif %}>Mar</option>
                <option value="4" {% if request.GET.month == "4" %}selected{% endif %}>Apr</option>
                <option value="5" {% if request.GET.month == "5" %}selected{% endif %}>May</option>
                <option value="6" {% if request.GET.month == "6" %}selected{% endif %}>Jun</option>
                <option value="7" {% if request.GET.month == "7" %}selected{% endif %}>Jul</option>
                <option value="8" {% if request.GET.month == "8" %}selected{% endif %}>Aug</option>
                <option value="9" {% if request.GET.month == "9" %}selected{% endif %}>Sep</option>
                <option value="10" {% if request.GET.month == "10" %}selected{% endif %}>Oct</option>
                <option value="11" {% if request.GET.month == "11" %}selected{% endif %}>Nov</option>
                <option value="12" {% if request.GET.month == "12" %}selected{% endif %}>Dec</option>
            </select>
        </div>

        <div class="flex gap-1 pl-2 border-l border-gray-100">
            <button type="submit" class="bg-indigo-600 text-white text-sm font-semibold py-1.5 px-4 rounded-md hover:bg-indigo-700 transition-colors shadow-sm">
                Apply
            </button>
            <a href="." class="px-3 py-1.5 bg-gray-100 text-gray-500 text-sm font-medium rounded-md hover:bg-gray-200 transition-colors">
                Clear
            </a>
        </div>
    </form>
</section>
</div>
</div>
         <!-- Search/Filter Form end -->
 <div x-data="{ activeSlide: 1, slides: {{ slides|length }} }" 
     class="relative overflow-hidden rounded-xl shadow-lg bg-gray-100">

    {% for slide in slides %}
    <div x-show="activeSlide === {{ forloop.counter }}" 
         x-transition:enter="transition opacity duration-500"
         class="relative w-full"> 
        {% if not slide.is_video %}
        <img src="{{ slide.image.url }}" class="block w-full max-h-fit h-auto">
{% else %}
                    <div class="video-container">
                        <video class="video"  poster="{{slide.video_thumbnail.url}}" controls>
                            <source src="{{slide.image.url}}" type="video/mp4">
                            <source src="{{slide.image.url}}" type="video/webm">
                            <source src="{{slide.image.url}}" type="video/ogg">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                    {% endif %}
        
        <div class="{% if not slide.is_video %} absolute {% else %} relative {% endif %} bottom-0 w-full bg-black/40 p-4 text-white">
            <p class="text-gray-600 flex justify-start">
    {% if slide.people %}
    <img src="{% static 'images/people.svg' %}" width="24" height="24" style="background: darksalmon; opacity: 0.6; border-radius: 5px; position: absolute;" alt="people">
    <span class="people ms-8">{{ slide.people|title|color_text|default:'No description available for this person.' }}</span>
    {% endif %}
    <hr class="opacity-30 ms-8">
            </p>
            
            <p class="text-fuchsia-600 leading-relaxed flex justify-between">
              <span class="photo-date">ðŸ“…: {{ slide.photo_taken_time|default:"No 'Image Taken Date' of  available for this image." }}</span>
              <span>
              {% if slide.is_location %}
                <small class="gps me-6" style="color: red;"><a href="https://www.google.com/maps?q={{ slide.latitude }},{{ slide.longitude }}" title="Go to Google Maps: {{ slide.latitude }}, {{ slide.longitude }}" target="_blank">&#128279; GEO Location</a></small>
              {% endif %}
              <span class="text-white">Slide No.: <span x-text="activeSlide"></span> of <span x-text="slides"></span></span></span>
            </p>
            
        </div>
    </div>
    {% endfor %}

    <button @click="activeSlide = activeSlide === 1 ? slides : activeSlide - 1" 
            class="absolute left-4 top-1/2 -translate-y-1/2 z-20 bg-white/50 hover:bg-white/80 p-3 rounded-full shadow-md transition-all text-gray-800">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
    </button>

    <button @click="activeSlide = activeSlide === slides ? 1 : activeSlide + 1" 
            class="absolute right-4 top-1/2 -translate-y-1/2 z-20 bg-white/50 hover:bg-white/80 p-3 rounded-full shadow-md transition-all text-gray-800">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
    </button>
</div>
</div>
        <!-- Pagination (includes all filter params) -->
        {% comment %} <!-- {% if is_paginated %}
        <nav class="mt-3 flex items-center justify-center space-x-2">
            {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.person_id %}&person_id={{ request.GET.person_id }}{% else %}&person_id=0{% endif %}{% if request.GET.year %}&year={{ request.GET.year }}{% else %}&year=0{% endif %}{% if request.GET.month %}&month={{ request.GET.month }}{% else %}&month=0{% endif %}" class="px-4 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">Previous</a>
            {% endif %}
            <span class="px-4 py-2 text-sm text-gray-500">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if request.GET.person_id %}&person_id={{ request.GET.person_id }}{% else %}&person_id=0{% endif %}{% if request.GET.year %}&year={{ request.GET.year }}{% else %}&year=0{% endif %}{% if request.GET.month %}&month={{ request.GET.month }}{% else %}&month=0{% endif %}" class="px-4 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">Next</a>
            {% endif %}
        </nav>
        {% endif %} --> {% endcomment %}

        {% if is_paginated %}
<nav class="mt-4 flex flex-wrap items-center justify-center gap-2">
    
    {# URL Parameter Fragment to avoid repetition #}
    {% captureas url_params %}{% if request.GET.person_id %}&person_id={{ request.GET.person_id }}{% else %}&person_id=0{% endif %}{% if request.GET.year %}&year={{ request.GET.year }}{% else %}&year=0{% endif %}{% if request.GET.month %}&month={{ request.GET.month }}{% else %}&month=0{% endif %}{% endcaptureas %}

    {# First Page #}
    {% if page_obj.number > 1 %}
        <a href="?page=1{{ url_params }}" class="px-3 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">First</a>
    {% endif %}

    {# Previous Page #}
    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{{ url_params }}" class="px-3 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">Previous</a>
    {% endif %}

    {# Page Numbers #}
    {% for i in page_obj.paginator.get_elided_page_range|default:page_obj.paginator.page_range %}
        {% if page_obj.number == i %}
            <span class="px-3 py-2 bg-blue-600 border border-blue-600 rounded-md text-sm font-medium text-white">{{ i }}</span>
        {% elif i == page_obj.paginator.ELLIPSIS %}
            <span class="px-3 py-2 text-gray-500">...</span>
        {% else %}
            <a href="?page={{ i }}{{ url_params }}" class="px-3 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">{{ i }}</a>
        {% endif %}
    {% endfor %}

    {# Next Page #}
    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{{ url_params }}" class="px-3 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">Next</a>
    {% endif %}

    {# Last Page #}
    {% if page_obj.number < page_obj.paginator.num_pages %}
        <a href="?page={{ page_obj.paginator.num_pages }}{{ url_params }}" class="px-3 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">Last</a>
    {% endif %}

</nav>
{% endif %}
{% endblock %}