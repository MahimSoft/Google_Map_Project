{% extends 'base.html' %}
{% load static %}
{% load mahimsoft_tags %}
{% load month_filters %}
{% block title %}
  Masud's Location History
{% endblock %}
{% block extend_header %}
  <style>
        /* Smooth transitions for hover effects */
        .img-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .img-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        /* Custom select styling for better appearance */
        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
        }
    </style>
{% endblock %}

{% block navbar %}
  {% include 'locations/navbar_person_images.html' %}
{% endblock %}

{% block content %}
<div class="bg-gray-50 font-sans antialiased max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Header Section -->
        <header class="text-center mb-3">
            <h1 class="text-4xl font-extrabold text-gray-900 tracking-tight sm:text-5xl">
                Our Friends and Family Photo Album
            </h1>
            <p class="mt-4 text-lg text-gray-600 max-w-2xl mx-auto">
                Filter by name and (optional) year/month to find friends and family members.
            </p>
            <h3 class="text-xl">
            Year: <span class="text-red-300">{% if people_images.0.photo_year %}{{people_images.0.photo_year}}{% else %}all, {% endif %}</span> Month: <span class="text-red-300">{% if people_images.0.photo_month %}{{people_images.0.photo_month|month_name}}{% else %}all{% endif %}, </span> Total Images: <span class="text-red-300">{{total_images|stringformat:"i"}}</span> 
                 </h3>
        </header>

        <!-- Search/Filter Form -->
        <section class="max-w-4xl mx-auto mb-3 bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
            <form method="GET" action="." class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Name Filter -->
                <div class="space-y-2">
                    <label for="person_select" class="block text-sm font-semibold text-gray-700">
                        Name
                    </label>
                    <select 
                        id="person_select" 
                        name="person_id" 
                        class="block w-full px-4 py-3 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-xl border appearance-none bg-white transition-all cursor-pointer"
                    >
                        <option value="">All People</option>
                        {% for person in people %}
                            <option value="{{ person.id }}" {% if request.GET.person_id == person.id|stringformat:"i" %}selected{% endif %}>
                                {{ person.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Year Filter -->
                <div class="space-y-2">
                    <label for="year_select" class="block text-sm font-semibold text-gray-700">
                        Year
                    </label>
                    <select 
                        id="year_select" 
                        name="year" 
                        class="block w-full px-4 py-3 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-xl border appearance-none bg-white transition-all cursor-pointer"
                    >
                        <option value="0">Any Year</option>
                        {% for y in years_list %}
                            <option value="{{ y }}" {% if request.GET.year == y|stringformat:"i" %}selected{% endif %}>{{ y }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Month Filter -->
                <div class="space-y-2">
                    <label for="month_select" class="block text-sm font-semibold text-gray-700">
                        Month
                    </label>
                    <select 
                        id="month_select" 
                        name="month" 
                        class="block w-full px-4 py-3 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-xl border appearance-none bg-white transition-all cursor-pointer"
                    >
                        <option value="0">Any Month</option>
                        <option value="1" {% if request.GET.month == "1" %}selected{% endif %}>January</option>
                        <option value="2" {% if request.GET.month == "2" %}selected{% endif %}>February</option>
                        <option value="3" {% if request.GET.month == "3" %}selected{% endif %}>March</option>
                        <option value="4" {% if request.GET.month == "4" %}selected{% endif %}>April</option>
                        <option value="5" {% if request.GET.month == "5" %}selected{% endif %}>May</option>
                        <option value="6" {% if request.GET.month == "6" %}selected{% endif %}>June</option>
                        <option value="7" {% if request.GET.month == "7" %}selected{% endif %}>July</option>
                        <option value="8" {% if request.GET.month == "8" %}selected{% endif %}>August</option>
                        <option value="9" {% if request.GET.month == "9" %}selected{% endif %}>September</option>
                        <option value="10" {% if request.GET.month == "10" %}selected{% endif %}>October</option>
                        <option value="11" {% if request.GET.month == "11" %}selected{% endif %}>November</option>
                        <option value="12" {% if request.GET.month == "12" %}selected{% endif %}>December</option>
                    </select>
                </div>

                <!-- Action Buttons -->
                <div class="md:col-span-3 flex flex-col sm:flex-row gap-3 pt-2">
                    <button type="submit" class="flex-1 bg-indigo-600 text-white font-bold py-3 px-6 rounded-xl hover:bg-indigo-700 transition-colors shadow-sm focus:ring-4 focus:ring-indigo-200">
                        Apply Filters
                    </button>
                    <a href="." class="px-8 py-3 bg-gray-100 text-gray-600 font-semibold rounded-xl hover:bg-gray-200 transition-colors flex items-center justify-center">
                        Clear All
                    </a>
                </div>
            </form>
        </section>

        <!-- Image Grid -->
        <div id="image-grid" class="scroll-mt-10 grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
            {% for person in people_images %}
            <div class="img-card bg-white rounded-2xl overflow-hidden border border-gray-100 shadow-sm">
                <div class="aspect-w-16 aspect-h-9 relative overflow-hidden bg-gray-200">
                    {% if person.image %}
                    {% if not person.is_video %}
                    <!-- <a href="{{ person.image.url }}" title="View Image" target="_blank"> -->
                    <img id="{{person.id}}: [{{forloop.counter}}]"
                    src="{{ person.image.url }}" 
                    alt="{{ person.name|title }}" 
                    class="w-full h-[400px] object-cover popup-image"
                    srcset="{{ person.image.url|safe }}"
                    onerror="this.src='https://via.placeholder.com/800x600?text=Image+Not+Found'"
                    >
                <!-- </a> -->
                    {% else %}
                <video class="w-full h-[400px] object-cover" controls>
                    <source src="{{person.image.url}}" type="video/mp4">
                    <source src="movie.webm" type="video/webm">
                    Your browser does not support the video tag.
                  </video>
                    {% endif %}
                    {% else %}
                        <div class="w-full h-[400px] flex items-center justify-center bg-gray-200 text-gray-400">
                            <span>No Image Available</span>
                        </div>
                    {% endif %}
                    <!-- <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent flex items-end">
                        <div class="p-6 w-full flex justify-between items-end">
                            <div>
                                <h3 class="text-2xl font-bold text-white">{{ person.person_name|default:"Unknown Person"}}</h3>
                                <p class="text-gray-200 text-sm font-medium uppercase tracking-wider">
                                    {{ person.people|default:'Member' }}
                                </p>
                            </div>
                            <div class="text-right text-gray-300 text-xs font-medium">
                                Joined: {{ person.month_name|default:"--" }} {{ person.year|default:"" }}
                            </div>
                        </div>
                    </div> -->
                </div>

                <div class="p-6">
<p class="text-gray-600 flex justify-start">
    <img src="{% static 'images/people.svg' %}" width="24" height="24" style="background: darksalmon; opacity: 0.6; border-radius: 5px; position: absolute;" alt="people">
    <span class="ms-8">{{ person.people|title|color_text|default:'No description available for this person.' }}</span>
    <hr class="opacity-30 ms-8">
            </p>
            
            <p class="text-gray-600 leading-relaxed">
              ðŸ“…: {{ person.photo_taken_time|default:"No 'Image Taken Date' of  available for this image." }}
              {% if person.is_location %}
                <small class="gps" style="color: red;"><a href="https://www.google.com/maps?q={{ person.latitude }},{{ person.longitude }}" title="Go to Google Maps: {{ person.latitude }}, {{ person.longitude }}" target="_blank">&#128279; GEO Location</a></small>
              {% endif %}
            </p>
            <div class="mt-6 flex items-center justify-between">
              <a href="#" class="text-indigo-600 font-semibold hover:text-indigo-800 transition-colors">View Profile &rarr;</a>
              <span class="text-xs text-gray-400">ID: #{{ person.id }} ({{ person.title }})</span>
            </div>
                </div>
            </div>
            {% empty %}
            <div class="col-span-full py-20 text-center bg-white rounded-2xl border-2 border-dashed border-gray-200">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">No matches found</h3>
                <p class="mt-1 text-sm text-gray-500">Try changing your Name, Year, or Month filters.</p>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination (includes all filter params) -->
        {% if is_paginated %}
        <nav class="mt-16 flex items-center justify-center space-x-2">
            {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.person_id %}&person_id={{ request.GET.person_id }}{% else %}&person_id=0{% endif %}{% if request.GET.year %}&year={{ request.GET.year }}{% else %}&year=0{% endif %}{% if request.GET.month %}&month={{ request.GET.month }}{% else %}&month=0{% endif %}#image-grid" class="px-4 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">Previous</a>
            {% endif %}
            <span class="px-4 py-2 text-sm text-gray-500">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if request.GET.person_id %}&person_id={{ request.GET.person_id }}{% else %}&person_id=0{% endif %}{% if request.GET.year %}&year={{ request.GET.year }}{% else %}&year=0{% endif %}{% if request.GET.month %}&month={{ request.GET.month }}{% else %}&month=0{% endif %}#image-grid" class="px-4 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">Next</a>
            {% endif %}
        </nav>
        {% endif %}
    </div>
    {% include 'slideshow.html' %}
{% endblock %}
